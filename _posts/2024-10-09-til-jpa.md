---
title: "[TIL] 7ì£¼ì°¨ â® BE - JPA"
excerpt: "JPA(Java Persistence API)ì˜ ê¸°ë³¸ ê°œë…ê³¼ ì‚¬ìš©ë²•ì„ ì„¤ëª…í•˜ë©°, JDBC, MyBatis, JPAë¥¼ ë¹„êµí•©ë‹ˆë‹¤."
categories:
  - blog
  - backend
tags:
  - spring
  - DB
  - TIL/WIL
---

# 1. JPA (Java Persistence API)
JPAëŠ” **ìë°” ê°ì²´ì™€ ê´€ê³„í˜• ë°ì´í„°ë² ì´ìŠ¤ ê°„ì˜ ë§¤í•‘(ORM, Object-Relational Mapping)ì„ ì œê³µí•˜ëŠ” í‘œì¤€ ì¸í„°í˜ì´ìŠ¤**ì´ë‹¤. ë°ì´í„°ë² ì´ìŠ¤ì™€ì˜ ìƒí˜¸ì‘ìš©ì„ ì‰½ê²Œ ê´€ë¦¬í•˜ê³  ìœ ì§€ë³´ìˆ˜í•  ìˆ˜ ìˆê²Œ í•œë‹¤.

- **JDBC**: SQL ì¿¼ë¦¬ê°€ ìë°” ì½”ë“œ ë‚´ì— ì§ì ‘ í¬í•¨ë˜ë¯€ë¡œ, SQLê³¼ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì´ í˜¼í•©ë˜ì–´ ë³µì¡
- **MyBatis**: SQL ì¿¼ë¦¬ë¥¼ XML íŒŒì¼ë¡œ ë¶„ë¦¬í•  ìˆ˜ ìˆì§€ë§Œ ì—¬ì „íˆ SQLì„ ì§ì ‘ ì‘ì„±
- **JPA**: SQLì„ ì§ì ‘ ì‘ì„±í•˜ì§€ ì•Šê³ , ê°ì²´ì§€í–¥ì  ì—”í„°í‹° ë§¤í•‘ê³¼ JPQL(Java Persistence Query Language)ì„ ì‚¬ìš©í•´ ë°ì´í„°ë² ì´ìŠ¤ ì‘ì—…ì„ ì²˜ë¦¬.
  - SQLì€ JPAê°€ ë‚´ë¶€ì ìœ¼ë¡œ ìë™ ìƒì„±í•˜ì—¬ ì‹¤í–‰

## ğŸŒ² JPAëŠ” ë­˜ê¹Œ ì™œ ì“°ëŠ”ê°€?
[ì°¸ê³ ](https://dbjh.tistory.com/77)

ì¸í„°í˜ì´ìŠ¤ ëª¨ì„ì´ë‹¤. ë”°ë¼ì„œ ì´ ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬ë‚˜ í”„ë ˆì„ì›Œí¬ê°€ í•„ìš”í•œë° ì´ëŸ¬í•œ êµ¬í˜„ì²´ ì¤‘ ë§ì´ ì‚¬ìš©ë˜ëŠ” ê²ƒì´ `Hibernate, EclipseLink, OpenJPA` ë“±ì´ë‹¤.
- JPAëŠ” ë°˜ë³µì ì¸ CRUD SQLì„ ìë™ìœ¼ë¡œ ìƒì„±í•´ ì²˜ë¦¬í•´ì¤€ë‹¤. ê°œë°œìëŠ” SQL ì¿¼ë¦¬ë¥¼ ì‘ì„±í•  í•„ìš” ì—†ìŒ
- SQLì´ ì•„ë‹Œ ê°ì²´ ì¤‘ì‹¬ ê°œë°œì´ ê°€ëŠ¥í•´ì§„ë‹¤. 
- JPAëŠ” ìë°”ì˜ ê°ì²´ ì§€í–¥ì ì¸ ê°œë…ê³¼ ê´€ê³„í˜• ë°ì´í„°ë² ì´ìŠ¤ì˜ ê´€ê³„ ëª¨ë¸ ê°„ì˜ ë¶ˆì¼ì¹˜ë¥¼ í•´ê²°í•œë‹¤.
	- ì˜ˆë¥¼ ë“¤ì–´, ìë°”ì—ì„œëŠ” ìƒì†ì„ í†µí•´ ë¶€ëª¨ì™€ ìì‹ í´ë˜ìŠ¤ ê°„ì˜ ê´€ê³„ë¥¼ ì •ì˜í•  ìˆ˜ ìˆì§€ë§Œ, ê¸°ì¡´ ê´€ê³„í˜• ë°ì´í„°ë² ì´ìŠ¤ëŠ” ì´ëŸ¬í•œ ìƒì† ê´€ê³„ë¥¼ ì§€ì›í•˜ì§€ ì•ŠëŠ”ë‹¤. (ìƒì† ë§ê³ ë„ ìˆìŒ)
		- JPAì—ì„œëŠ” ê°ì²´ì˜ ìƒì† ê´€ê³„ë¥¼ ë°ì´í„°ë² ì´ìŠ¤ì— ë§¤í•‘í•˜ëŠ” ë°©ë²•ì„ ì œê³µí•œë‹¤. 
		> **ë‹¨ì¼ í…Œì´ë¸” ì „ëµ**, **êµ¬í˜„ í…Œì´ë¸” ì „ëµ**, **ë§¤í•‘ í…Œì´ë¸” ì „ëµ**

## JPA ì €ì¥ ë° ì¡°íšŒ êµ¬ì¡°
![image](https://github.com/user-attachments/assets/267db2a0-1e17-4d93-92e9-e647d547fe0f)

![image](https://github.com/user-attachments/assets/a30ecfce-e636-4ae1-8dcf-bfc54947eed0)


## ğŸŒ² JPAëŠ” ì–´ë–»ê²Œ ì‚¬ìš©í•˜ëŠ”ê°€?
[ì°¸ê³ ](https://ccomccomhan.tistory.com/131)
### 1) ì—”í„°í‹°(Entity)
- **ì—”í„°í‹° í´ë˜ìŠ¤**ëŠ” ë°ì´í„°ë² ì´ìŠ¤ì˜ í…Œì´ë¸”ê³¼ ë§¤í•‘ë˜ëŠ” ìë°” ê°ì²´
- í´ë˜ìŠ¤ ìœ„ì— `@Entity` ì–´ë…¸í…Œì´ì…˜ì„ ì‚¬ìš©í•´ ì„ ì–¸
```java
@Entity // ì—”í‹°í‹° í´ë˜ìŠ¤ì„ì„ ì„ ì–¸.
@Table(name = "users") // í•´ë‹¹ ì—”í‹°í‹° í´ë˜ìŠ¤ì™€ ë§¤í•‘ë  ë°ì´í„°ë² ì´ìŠ¤ í…Œì´ë¸” ì´ë¦„ì„ ì§€ì •.
public class User {
    @Id // ì—”í‹°í‹° í´ë˜ìŠ¤ì˜ ì£¼ìš” ì‹ë³„ì(primary key)ì„ì„ ì„ ì–¸
    @GeneratedValue(strategy = GenerationType.IDENTITY) // ì—”í‹°í‹°ì˜ ì‹ë³„ì ê°’ì„ ìë™ìœ¼ë¡œ ìƒì„±
    private Long id;

    // í•´ë‹¹ ì—”í‹°í‹° í´ë˜ìŠ¤ì˜ í•„ë“œê°€ ë°ì´í„°ë² ì´ìŠ¤ì˜ ì¹¼ëŸ¼ìœ¼ë¡œ ë§¤í•‘ë  ë•Œ,
    // í•´ë‹¹ ì¹¼ëŸ¼ì˜ ì œì•½ ì¡°ê±´ì„ ì„¤ì •í•˜ëŠ” ì–´ë…¸í…Œì´ì…˜ì…ë‹ˆë‹¤. (ë„í—ˆìš©, ê³ ìœ ì„±, ê¸¸ì´ ë“±)
    @Column(nullable = false, unique = true) 
    private String username;

    @Column(nullable = false)
    private String password;

    // getters and setters
}
```

### 2) **ë¦¬í¬ì§€í† ë¦¬(Repository)**
- ë¦¬í¬ì§€í† ë¦¬ëŠ” ë°ì´í„°ë² ì´ìŠ¤ì— ì ‘ê·¼í•˜ëŠ” ì¸í„°í˜ì´ìŠ¤ì´ë‹¤. ë³´í†µ `JpaRepository` ì¸í„°í˜ì´ìŠ¤ë¥¼ ìƒì†ë°›ì•„ êµ¬í˜„
- JpaRepository ì¸í„°í˜ì´ìŠ¤ë¥¼ ìƒì†ë°›ê¸°ì— ë”°ë¡œ ë©”ì„œë“œ êµ¬í˜„, êµ¬í˜„ì²´ ì‘ì„±ì„ í•˜ì§€ ì•Šì•„ë„ ìë™ìœ¼ë¡œ ìƒì„±ëœë‹¤.

```java
// í•´ë‹¹ ì¸í„°í˜ì´ìŠ¤ê°€ ìŠ¤í”„ë§ì˜ ë°ì´í„° ì ‘ê·¼ ê³„ì¸µ(Data Access Layer)ì˜ ì»´í¬ë„ŒíŠ¸ì„ì„ ì„ ì–¸
@Repository
// JpaRepository<User, Long> ì¸í„°í˜ì´ìŠ¤ : ìŠ¤í”„ë§ ë°ì´í„° JPAì—ì„œ ì œê³µí•˜ëŠ” CRUD ë©”ì„œë“œë¥¼ ìƒì†ë°›ì•„ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ì¸í„°í˜ì´ìŠ¤ì…ë‹ˆë‹¤.
public interface UserRepository extends JpaRepository<User, Long> {
    // usernameìœ¼ë¡œ User ì—”í‹°í‹°ë¥¼ ì°¾ëŠ” ë©”ì„œë“œ
    Optional<User> findByUsername(String username);
}

```
### 3) ì—”í‹°í‹° ë§¤ë‹ˆì € íŒ©í† ë¦¬ ì„¤ì •
- application.properties ë˜ëŠ” application.yml íŒŒì¼ì„ ì´ìš©í•˜ì—¬ **JPA ì„¤ì • ì •ë³´ë¥¼ ì •ì˜
- ìŠ¤í”„ë§ì´ ìë™ìœ¼ë¡œ `EntityManagerFactory`ë¥¼ ì„¤ì •

```properties
# JSP ë·° ì„¤ì •
spring.mvc.view.prefix=/WEB-INF/views/  # JSP íŒŒì¼ ë””ë ‰í† ë¦¬
spring.mvc.view.suffix=.jsp               # JSP íŒŒì¼ í™•ì¥ì

# MySQL ë°ì´í„°ë² ì´ìŠ¤ ì„¤ì •
spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver  # ë°ì´í„°ë² ì´ìŠ¤ ë“œë¼ì´ë²„
spring.datasource.url=jdbc:mysql://localhost:3306/ë§ëŠ”ê±¸ë¡œì‘ì„±?useSSL=false&serverTimezone=UTC  # DB ì—°ê²° URL
spring.datasource.username=root  # DB ì‚¬ìš©ì ì´ë¦„
spring.datasource.password=1234   # DB ë¹„ë°€ë²ˆí˜¸

# Hibernate ì„¤ì •
spring.jpa.properties.hibernate.show_sql=true  # SQL ì¿¼ë¦¬ ì¶œë ¥
spring.jpa.properties.hibernate.format_sql=true  # SQL ì¿¼ë¦¬ í¬ë§·
spring.jpa.show-sql=true  # JPA SQL ì¿¼ë¦¬ ì¶œë ¥

# DDL ìë™ ìƒì„± ì„¤ì •
spring.jpa.properties.hibernate.hbm2ddl.auto=update  # DB ìŠ¤í‚¤ë§ˆ ìë™ ì—…ë°ì´íŠ¸
```

### 4) **ì„œë¹„ìŠ¤(Service)** í´ë˜ìŠ¤
- ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì„ ì²˜ë¦¬. ì—¬ê¸°ì„œ ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ë°ì´í„°ë¥¼ ì¡°íšŒí•˜ê±°ë‚˜, ìƒˆë¡œìš´ ë°ì´í„°ë¥¼ ì‚½ì…, ìˆ˜ì •, ì‚­ì œ(CRUD)í•  ìˆ˜ ìˆë‹¤.

```java
@Service
public class UserService {
    @Autowired // UserRepository ì£¼ì…
    private UserRepository userRepository;
    
	// ëª¨ë“  ì‚¬ìš©ì ì¡°íšŒ
    public List<User> findAllUsers() {
        return userRepository.findAll();
    }
    public User saveUser(User user) {
        return userRepository.save(user);
    }
}
```

### 4) ì»¨íŠ¸ë¡¤ëŸ¬ í´ë˜ìŠ¤
- REST APIë¥¼ ì œê³µí•˜ëŠ” ì»¨íŠ¸ë¡¤ëŸ¬. ì‚¬ìš©ìë¥¼ ì¡°íšŒí•˜ëŠ” GET ìš”ì²­ê³¼ ì‚¬ìš©ì ìƒì„±ì„ ìœ„í•œ POST ìš”ì²­ì„ ì²˜ë¦¬.
```java
@RestController // RESTful ì›¹ ì„œë¹„ìŠ¤ì˜ ì»¨íŠ¸ë¡¤ëŸ¬ì„ì„ ì„ ì–¸ @RequestMapping("/users") // ìš”ì²­ URLì˜ ê¸°ë³¸ ê²½ë¡œ ì„¤ì • 
public class UserController { 
	@Autowired // UserService ì£¼ì… 
	private UserService userService; // ëª¨ë“  ì‚¬ìš©ì ì •ë³´ë¥¼ ë°˜í™˜í•˜ëŠ” GET ìš”ì²­ ì²˜ë¦¬ 
	@GetMapping // /users ê²½ë¡œë¡œ GET ìš”ì²­ ì‹œ 
	public List<User> getAllUsers() { 
		return userService.findAllUsers(); // ì‚¬ìš©ì ëª©ë¡ ë°˜í™˜ 
	} 
	// ìƒˆë¡œìš´ ì‚¬ìš©ì ì •ë³´ë¥¼ ì €ì¥í•˜ëŠ” POST ìš”ì²­ ì²˜ë¦¬ 
	@PostMapping // /users ê²½ë¡œë¡œ POST ìš”ì²­ ì‹œ 
	public User createUser(@RequestBody User user) { 
		return userService.saveUser(user); // ì‚¬ìš©ì ì €ì¥ í›„ ë°˜í™˜ 
	}
}
```

## ğŸŒ² JDBC, MyBatis, JPA ì‚¬ìš© ë¹„êµ
### 1) JDBC ì‚¬ìš©
JDBCë¥¼ ì‚¬ìš©í•˜ì—¬ SQL ì¿¼ë¦¬ë¥¼ ì§ì ‘ ì‘ì„±í•˜ê³  ë°ì´í„°ë² ì´ìŠ¤ì™€ ìƒí˜¸ì‘ìš©í•´ì•¼ í•¨
```java
import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
public class UserJdbcExample {
    private static final String URL = "jdbc:mysql://localhost:3306/mydb";
    private static final String USER = "username";
    private static final String PASSWORD = "password";
	// ì‚¬ìš©ì ì €ì¥ (INSERT)
    public void saveUser(String name) {
        try (Connection connection = DriverManager.getConnection(URL, USER, PASSWORD);
             PreparedStatement preparedStatement = connection.prepareStatement("INSERT INTO users (name) VALUES (?)")) {
             
            preparedStatement.setString(1, name);
            preparedStatement.executeUpdate(); // SQL ì¿¼ë¦¬ ì‹¤í–‰
        } catch (Exception e) {
            e.printStackTrace();
        }
    }
	// ëª¨ë“  ì‚¬ìš©ì ì¡°íšŒ (SELECT)
    public void findAllUsers() {
        try (Connection connection = DriverManager.getConnection(URL, USER, PASSWORD);
             PreparedStatement preparedStatement = connection.prepareStatement("SELECT * FROM users");
             ResultSet resultSet = preparedStatement.executeQuery()) {
             
            while (resultSet.next()) {
                System.out.println("User: " + resultSet.getString("name"));
            }
        } catch (Exception e) {
            e.printStackTrace();
        }
    }
}
```

### 2) MyBatis ì‚¬ìš©
```java
// MyBatisë¥¼ ì‚¬ìš©í•˜ì—¬ XML íŒŒì¼ì— SQLì„ ë¶„ë¦¬í•˜ê³ , ë§¤í¼ ì¸í„°í˜ì´ìŠ¤ë¥¼ í†µí•´ DB ì ‘ê·¼
import org.apache.ibatis.annotations.Insert;
import org.apache.ibatis.annotations.Select;
import java.util.List;

public interface UserMapper {
    // SQLì„ XML íŒŒì¼ì´ë‚˜ ì–´ë…¸í…Œì´ì…˜ìœ¼ë¡œ ë¶„ë¦¬í•  ìˆ˜ ìˆìŒ
    @Insert("INSERT INTO users (name) VALUES (#{name})")
    void saveUser(String name);

    @Select("SELECT * FROM users")
    List<String> findAllUsers();
}

// ì„œë¹„ìŠ¤ í´ë˜ìŠ¤ì—ì„œ MyBatis ë§¤í¼ ì¸í„°í˜ì´ìŠ¤ ì‚¬ìš©
@Service
public class UserService {
    @Autowired
    private UserMapper userMapper;

    public void saveUser(String name) {
        userMapper.saveUser(name); // ì‚¬ìš©ì ì €ì¥ (MyBatisê°€ SQLì„ ì‹¤í–‰)
    }

    public void findAllUsers() {
        List<String> users = userMapper.findAllUsers(); // ì‚¬ìš©ì ëª©ë¡ ì¡°íšŒ
        users.forEach(user -> System.out.println("User: " + user));
    }
}

```
### 3) **JPAë¥¼ ì‚¬ìš©í•˜ëŠ” ê²½ìš°**
JPAë¥¼ ì‚¬ìš©í•˜ë©´ ì—”í„°í‹° í´ë˜ìŠ¤ë¥¼ ì •ì˜í•˜ê³ , ë¦¬í¬ì§€í† ë¦¬ ì¸í„°í˜ì´ìŠ¤ë¥¼ í†µí•´ ë°ì´í„°ë² ì´ìŠ¤ì— ì ‘ê·¼í•  ìˆ˜ ìˆìŒ
```java
import javax.persistence.*;
import java.util.List;

@Entity
public class User {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY) // ID ìë™ ìƒì„±
    private Long id;
    private String name;
    // Getters and Setters
}
// ë¦¬í¬ì§€í† ë¦¬---------------------------------------------------------
import org.springframework.data.jpa.repository.JpaRepository;

public interface UserRepository extends JpaRepository<User, Long> {
    // ê¸°ë³¸ì ì¸ CRUD ë©”ì„œë“œëŠ” ìë™ ìƒì„± (save, findAll ë“±)
}
// ì„œë¹„ìŠ¤í´ë˜ìŠ¤-------------------------------------------------------
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

@Service
public class UserService {
    @Autowired
    private UserRepository userRepository;

    public void saveUser(String name) {
        User user = new User();
        user.setName(name);
        userRepository.save(user); // JPAê°€ ìë™ìœ¼ë¡œ SQLì„ ìƒì„±í•˜ê³  ì‹¤í–‰
    }
    public void findAllUsers() {
        List<User> users = userRepository.findAll();
        for (User user : users) {
            System.out.println("User: " + user.getName());
        }
    }
}

```

### 3. ë¹„êµí•˜ê¸°
#### JDBC ì‚¬ìš©
- ë°ì´í„°ë² ì´ìŠ¤ì— ì§ì ‘ SQL ì¿¼ë¦¬ë¥¼ ì‘ì„±í•´ì•¼ í•œë‹¤. ì´ëŠ” ì½”ë“œê°€ ë³µì¡í•´ì§ˆ ìˆ˜ ìˆê³ , SQL êµ¬ë¬¸ ì˜¤ë¥˜ê°€ ë°œìƒí•  ìˆ˜ ìˆë‹¤.
- ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²°ì„ ìˆ˜ë™ìœ¼ë¡œ ê´€ë¦¬í•´ì•¼ í•˜ë©°, ê° ì¿¼ë¦¬ì— ëŒ€í•´ `PreparedStatement`ì™€ `ResultSet`ì„ ëª…ì‹œì ìœ¼ë¡œ ì²˜ë¦¬í•´ì•¼ í•œë‹¤.
- ë™ì¼í•œ CRUD ì‘ì—…ì„ ì—¬ëŸ¬ ë²ˆ ë°˜ë³µí•´ì•¼ í•˜ë©°, ì½”ë“œê°€ ì¤‘ë³µë  ìˆ˜ ìˆë‹¤.

#### MyBatis ì‚¬ìš©
- SQLì„ XML íŒŒì¼ ë˜ëŠ” ì–´ë…¸í…Œì´ì…˜ìœ¼ë¡œ ë¶„ë¦¬í•´ ìë°” ì½”ë“œì™€ ë¶„ë¦¬ ê°€ëŠ¥
- SQL ì¿¼ë¦¬ ê²°ê³¼ë¥¼ ìë°” ê°ì²´ë¡œ ìë™ìœ¼ë¡œ ë§¤í•‘ ê°€ëŠ¥
- SQL ì¿¼ë¦¬ë¥¼ ì§ì ‘ ì‘ì„±í•´ì•¼ í•˜ì§€ë§Œ, ìë°” ì½”ë“œì™€ ë¶„ë¦¬í•  ìˆ˜ ìˆë‹¤ëŠ” ì¥ì .
 
#### **JPA ì‚¬ìš©**
- ë°ì´í„°ë² ì´ìŠ¤ì˜ í…Œì´ë¸”ì— ë§¤í•‘ëœ ìë°” í´ë˜ìŠ¤ë¥¼ ì •ì˜í•˜ì—¬ ê°ì²´ ì§€í–¥ì ìœ¼ë¡œ ë°ì´í„°ë¥¼ ì²˜ë¦¬í•  ìˆ˜ ìˆìŒ.
- **ë¦¬í¬ì§€í† ë¦¬ íŒ¨í„´**: JPAì˜ `JpaRepository` ì¸í„°í˜ì´ìŠ¤ë¥¼ í†µí•´ CRUD ì‘ì—…ì„ ê°„í¸í•˜ê²Œ ìˆ˜í–‰í•  ìˆ˜ ìˆìœ¼ë©°, ì¶”ê°€ì ì¸ ì¿¼ë¦¬ ë©”ì„œë“œë¥¼ ì‰½ê²Œ ì •ì˜í•  ìˆ˜ ìˆìŒ.
- ë°ì´í„°ë² ì´ìŠ¤ì™€ì˜ ìƒí˜¸ì‘ìš©ì´ ë‹¨ìˆœí™”ë˜ì–´ ì½”ë“œê°€ í›¨ì”¬ ê°„ê²°í•˜ê³  ì½ê¸° ì‰¬ì›€ (ìœ ì§€ë³´ìˆ˜ êµ¿)
